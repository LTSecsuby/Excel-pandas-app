<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <!--Import Google Icon Font-->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--Import materialize.css-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <!--Let browser know website is optimized for mobile-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>
        <div>
            <div class="wrapper">
                <div class="wrapper-uploader card blue-grey darken-1">
                    <div style="position: relative;" class="card-content white-text">
                        <span class="card-title">Меню</span>
                        <a onclick="showSettingsPopup()" class="waves-effect waves-light btn">Настройки</a>
                        <div class="uploader">
                            <form id="upload-form" enctype="multipart/form-data">
                                <div style="display: flex; align-items: center;" class="file-field input-field">
                                    <div class="btn-floating waves-effect waves-light">
                                        <i class="material-icons">file_upload</i>
                                        <input id='excel-files' type="file" multiple name="files" accept=".xlsx">
                                    </div>
                                    <div style="width: 80%;" class="file-path-wrapper">
                                        <input placeholder="Загрузите excel файлы" style="color: white; border-bottom: 1px solid;" type="text" class="file-path">
                                    </div>
                                </div>
                            </form>
                            <div style="display: flex; align-items: center; justify-content: space-around;">
                                <select style="display: block; width: 75%;" id="templates-list"></select>
                                <a onclick="downloadCurrentTemplate()" class="btn-floating btn waves-effect waves-light"><i class="material-icons">cloud_download</i></a>
                                <a onclick="loadInstructionForCurrentTemplate()" class="btn-floating btn waves-effect waves-light"><i class="material-icons">info_outline</i></a>
                            </div>
                        </div>
                    </div>
                    <div class="card-action">
                        <button onclick="sendFile()" class="btn waves-effect waves-light red" type="submit" name="action">Запустить скрипт
                            <i class="material-icons right">send</i>
                        </button>
                    </div>
                </div>
                <div id="download-button-wrapper" class="download-button-wrapper">
                    <a style="position: fixed; z-index: 10;" onclick="downloadCurrentTable()" class="btn-floating btn-large waves-effect waves-light"><i class="material-icons">cloud_download</i></a>
                </div>
                <div id="pandas-table">
                    
                </div>
                <div id="loader-wrapper">
                    <div class="preloader-wrapper big active">
                        <div class="spinner-layer spinner-blue">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-red">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-yellow">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-green">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="alert-popup-wrapper">
                <div class="alert-popup col s12 m7">
                    <div style="margin: 0 auto; overflow-y: scroll;" class="card horizontal">
                      <div class="card-stacked">
                        <div id="error-title" class="card-content">
                            Внимание
                        </div>
                        <div class="card-content">
                            <div id="error-text"></div>
                        </div>
                        <div class="card-action">
                            <a onclick="closeAlertPopup()" class="waves-effect waves-light btn red">Закрыть</a>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <div id="info-popup-wrapper">
                <div class="info-popup">
                    <div class="row" style="display: flex;
                    align-items: center;
                    justify-content: center;
                    width: 60%; min-width: 400px;">
                        <div style="width: 100%;">
                          <div class="card blue-grey darken-1">
                            <div class="card-content white-text">
                                <span class="card-title">Инструкция</span>
                                <div style="position: absolute;
                                right: 5px;
                                top: 5px;">
                                    <a onclick="closeInfoPopup()" class="btn-floating btn-small waves-effect waves-light red"><i class="material-icons">close</i></a>
                                </div>
                              <p id="info-text"></p>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="settings-popup-wrapper">
                <div class="settings-popup" class="row">
                    <div>
                        <div class="card blue-grey darken-1">
                            <div class="card-content white-text">
                                <span class="card-title">Настройки</span>
                                <div class="close-action">
                                    <a onclick="closeSettingsPopup()" class="btn-floating btn waves-effect waves-light red"><i class="material-icons">close</i></a>
                                </div>
                                <div style="display: flex;">
                                    <div style="display: flex; align-items: center; margin-right: 25px;">
                                        <div class="input-field col s6">
                                            <input id="settingsNameInput" placeholder="Введите название" type="text" class="validate">
                                            <label style="color: #26a69a; font-size: 20px;" for="settingsNameInput">Добавить настройку</label>
                                        </div>
                                        <a onclick="addNewSettingsItem()" class="btn-floating btn waves-effect waves-light"><i class="material-icons">add</i></a>
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <div class="input-field col s12">
                                            <div>Выберите настройку</div>
                                            <select id="settings-list" style="display: block;">
                                            </select>
                                        </div>
                                        <a onclick="loadCurrentSetting()" class="waves-effect waves-light btn">Загрузить настройку</a>
                                    </div>
                                </div>
                                <div id="settingsItem" class="settings-items">
            
                                </div>
                            </div>
                            <div class="card-action">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="display: flex; justify-content: center; align-items: center;">
                                        <form id="python-upload-form" enctype="multipart/form-data">
                                            <div style="display: flex; align-items: center;" class="file-field input-field">
                                                <div class="btn-floating waves-effect waves-light">
                                                    <i class="material-icons">file_upload</i>
                                                    <input id='python-files' type="file" name="file" accept=".py">
                                                </div>
                                                <div style="width: 80%;" class="file-path-wrapper">
                                                    <input placeholder="Загрузите скрипт" style="color: white; border-bottom: 1px solid;" disabled class="file-path" type="text">
                                                </div>
                                            </div>
                                        </form>
                                        <a onclick="savePython()" class="waves-effect waves-light btn">Сохранить</a>
                                    </div>
                                    <div style="display: flex;">
                                        <div style="display: flex; align-items: center;">
                                            <div class="input-field col s12" style="padding-right: 5px;">
                                                <select id="videos-list" style="display: block;">
                                                </select>
                                            </div>
                                            <a onclick="loadVideos()" class="waves-effect waves-light btn">Открыть видео</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>

            function generateId() {
                const prefix = "id-";
                const randomNumber = Math.random().toString(36).substring(2);
                return prefix + randomNumber;
            }

            function addNewSettingsItem() {
                let name = document.getElementById('settingsNameInput').value;
                if (!name) {
                    name = generateId();
                }

                const wrapper = document.getElementById('settingsItem');
                wrapper.innerHTML = `
                    <div class="settings-item">
                        <table id="${name}">
                            <caption>${name} </caption>
                            <thead>
                                <tr>
                                    <th>
                                        <textarea></textarea>
                                    </th>
                                    <th>
                                        <a onclick="addColumn(this, '${name}')" class="btn-floating btn-small waves-effect waves-light"><i class="material-icons">add</i></a>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="table-button">
                            <a onclick="addCells('${name}')" class="waves-effect waves-light btn">Добавить ячейки</a>
                            <a onclick="saveTable('${name}')" class="waves-effect waves-light btn red">Сохранить</a>
                        </div>
                    </div>
                `
            }

            function addColumn(btn, tableName) {
                var row = btn.parentNode.parentNode.innerHTML = `
                    <th>
                        <textarea></textarea>
                    </th>
                ` + btn.parentNode.parentNode.innerHTML;
                var table = document.getElementById(tableName);
                var tbody = table.getElementsByTagName("tbody")[0];
                var rows = tbody.getElementsByTagName("tr");
                if (rows.length > 0) {
                    for (var i = 0; i < rows.length; i++) {
                        var cell = rows[i].insertCell(0);
                        cell.innerHTML = '<textarea></textarea>';
                    }
                }
            }

            function addCells(tableName) {
                var table = document.getElementById(tableName);
                var thead = table.getElementsByTagName("thead")[0];
                var cols = thead.rows[0].cells.length;

                var tbody = table.getElementsByTagName("tbody")[0];
                var newRow = tbody.insertRow(tbody.rows.length);
                
                for (let i = 0; i < cols; i++) {
                    if (i === cols - 1) {
                        newRow.insertCell(i).innerHTML = '<a onclick="deleteRow(this)" class="btn-floating btn-small waves-effect waves-light red"><i class="material-icons">delete</i></a>';
                    } else {
                        newRow.insertCell(i).innerHTML = '<textarea></textarea>';
                    }
                }
            }

            function saveTable(tableName) {
                var table = document.getElementById(tableName);
                var thead = table.getElementsByTagName("thead")[0];
                var columns = thead.rows[0].cells.length;

                var tbody = table.getElementsByTagName("tbody")[0];
                var rows = tbody.getElementsByTagName("tr");
                var data = {
                    title: tableName,
                    table: [],
                };
                for (var i = 0; i < columns; i++) {
                    var th = thead.rows[0].cells[i];
                    const input = th.getElementsByTagName("textarea")[0];
                    if (input) {
                        var key = th.getElementsByTagName("textarea")[0].value;
                        const values = [];
                        for (var j = 0; j < rows.length; j++) {
                            var cells = rows[j].getElementsByTagName("td");
                            var value = cells[i].getElementsByTagName("textarea")[0].value;
                            values.push(value.replace(/\n/g, '<br/>'));
                        }
                        data.table.push({ key, values });
                    }
                }

                saveSetting(data);
            }

            function loadTable(data) {
                const tableName = data.title;

                const wrapper = document.getElementById('settingsItem');

                const div = document.createElement('div');
                div.className = 'settings-item';

                const newTable = document.createElement('table');
                newTable.id = tableName;

                const caption = document.createElement('caption');
                caption.innerHTML = tableName;

                const thead = document.createElement('thead');
                const tbody = document.createElement('tbody');
                const tr = document.createElement('tr');

                newTable.appendChild(caption);
                newTable.appendChild(thead);
                newTable.appendChild(tbody);

                // data.table.forEach(col => {
                //     const th = document.createElement('th');
                //     th.innerHTML = '<input type="text" value="' + col.key + '">';
                //     tr.appendChild(th);
                // });

                data.table.forEach(col => {
                    const th = document.createElement('th');
                    const textarea = document.createElement('textarea');
                    textarea.value = col.key;
                    th.appendChild(textarea);
                    tr.appendChild(th);
                });

                const thAdd = document.createElement('th');
                thAdd.innerHTML = `<a onclick="addColumn(this, '${tableName}')" class="btn-floating btn-small waves-effect waves-light"><i class="material-icons">add</i></a>`;
                tr.appendChild(thAdd);
                thead.appendChild(tr);

                const values = [];
                let count = 0;

                if (data.table[0].values) {
                    count = data.table[0].values.length;
                    for (var i = 0; i < data.table.length; i++) {
                        const arr = [];
                        for (var j = 0; j < data.table[i].values.length; j++) {
                            arr.push(data.table[i].values[j]);
                        }
                        values.push(arr);
                    }
                }

                // for (var i = 0; i < count; i++) {
                //     var newRow = tbody.insertRow(i);
                //     for (var j = 0; j < data.table.length; j++) {
                //         var cell = newRow.insertCell(j);
                //         cell.innerHTML = '<input type="text" value="' + values[j][i] + '">';
                //         if (j + 1 === data.table.length) {
                //             var cell = newRow.insertCell(data.table.length);
                //             cell.innerHTML = '<a onclick="deleteRow(this)" class="btn-floating btn-small waves-effect waves-light red"><i class="material-icons">delete</i></a>'; 
                //         }
                //     }
                // }

                
                for (var i = 0; i < count; i++) {
                    var newRow = tbody.insertRow(i);
                    for (var j = 0; j < data.table.length; j++) {
                        var cell = newRow.insertCell(j);
                        var textarea = document.createElement('textarea');
                        textarea.value = values[j][i];
                        cell.appendChild(textarea);
                        if (j + 1 === data.table.length) {
                            var cell = newRow.insertCell(data.table.length);
                            cell.innerHTML = '<a onclick="deleteRow(this)" class="btn-floating btn-small waves-effect waves-light red"><i class="material-icons">delete</i></a>'; 
                        }
                    }
                }

                div.appendChild(newTable);

                const buttons = document.createElement('div');
                buttons.className = 'table-button';
                buttons.innerHTML = `
                    <a onclick="addCells('${tableName}')" class="waves-effect waves-light btn">Добавить ячейки</a>
                    <a onclick="saveTable('${tableName}')" class="waves-effect waves-light btn red">Сохранить</a>
                `;

                div.appendChild(buttons);
                wrapper.innerHTML = '';
                wrapper.appendChild(div);
            }

            function deleteRow(btn) {
                var row = btn.parentNode.parentNode;
                row.parentNode.removeChild(row);
            }

            function closeInfoPopup() {
                const infoText = document.getElementById("info-text").innerHTML = "";
                const info = document.getElementById("info-popup-wrapper");
                info.style.display = "none";
            }

            function showInfoPopup(text) {
                const infoText = document.getElementById("info-text").innerHTML = text;
                const info = document.getElementById("info-popup-wrapper");
                info.style.display = "flex";
            }

            function closeAlertPopup() {
                const errorText = document.getElementById("error-text").innerHTML = "";
                const alert = document.getElementById("alert-popup-wrapper");
                alert.style.display = "none";
            }

            function showAlertPopup(text) {
                const errorText = document.getElementById("error-text").innerHTML = text;
                const alert = document.getElementById("alert-popup-wrapper");
                alert.style.display = "flex";
            }

            function closeSettingsPopup() {
                const alert = document.getElementById("settings-popup-wrapper");
                alert.style.display = "none";
            }
            function showSettingsPopup() {
                const alert = document.getElementById("settings-popup-wrapper");
                alert.style.display = "flex";
            }

            function getTemplatesList() {
                if (!loadToken()) { return; }

                const currentUrl = window.location.href;
                const url = currentUrl + 'templates';

                const token = loadToken();
                if (!token) { return; }

                $.ajax({
                    url: url,
                    method: "GET",
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    dataType: 'json',
                    async: true,
                    success: function (templates) {
                        const select = document.getElementById("templates-list");
                        select.innerHTML = "";
                        templates.forEach(function (template) {
                            const option = document.createElement("option");
                            const div = document.createElement("div");
                            div.className = "template";
                            div.appendChild(document.createTextNode(template));
                            option.appendChild(div);
                            select.appendChild(option);
                        });
                    },
                    error: function (error) {
                        showAlertPopup("Отсутствуют шаблоны");
                    }
                });
                
            }

            function getSettingsList() {
                if (!loadToken()) { return; }

                const currentUrl = window.location.href;
                const url = currentUrl + 'settings';

                const token = loadToken();
                if (!token) { return; }

                $.ajax({
                    url: url,
                    method: "GET",
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    dataType: 'json',
                    async: true,
                    success: function (settings) {
                        const select = document.getElementById("settings-list");
                        select.innerHTML = "";
                        settings.forEach(function (setting) {
                            const option = document.createElement("option");
                            const div = document.createElement("div");
                            div.className = "setting";
                            div.appendChild(document.createTextNode(setting));
                            option.appendChild(div);
                            select.appendChild(option);
                        });
                    },
                    error: function (error) {
                        showAlertPopup("Настройки не загружены");
                    }
                });
                
            }

            function getVideosList() {
                const currentUrl = window.location.href;
                const url = currentUrl + 'videos';

                const token = loadToken();
                if (!token) { return; }

                $.ajax({
                    url: url,
                    method: "GET",
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    dataType: 'json',
                    async: true,
                    success: function (videos) {
                        const select = document.getElementById("videos-list");
                        select.innerHTML = "";
                        videos.forEach(function (video) {
                            const option = document.createElement("option");
                            const div = document.createElement("div");
                            div.className = "video";
                            const text = document.createTextNode(video.name);
                            div.setAttribute("url", video.url);
                            div.appendChild(text);
                            option.appendChild(div);
                            select.appendChild(option);
                        });
                    },
                    error: function (error) {
                        showAlertPopup("Видео не загружены");
                    }
                });
            }

            function showDownloadTable() {
                const downloadTable = document.getElementById("download-button-wrapper");
                downloadTable.style.display = 'flex';
            }

            function hiddenDownloadTable() {
                const downloadTable = document.getElementById("download-button-wrapper");
                downloadTable.style.display = 'none';
            }

            function showLoader() {
                const loader = document.getElementById("loader-wrapper");
                loader.style.display = "flex";
            }

            function hiddenLoader() {
                const loader = document.getElementById("loader-wrapper");
                loader.style.display = "none";
            }

            function sendFile() {
                // const contractors = document.getElementById("contractor-list");
                // if (contractors.childElementCount === 0) {
                //     showAlertContractor();
                //     return;
                // }
                const currentUrl = window.location.href;
                const url = currentUrl + 'python';

                const token = loadToken();
                if (!token) { return; }
                showLoader();

                const files = document.getElementById("excel-files");
                const formData = new FormData();

                const selectValue = document.getElementById("templates-list").value;
                formData.append('template', selectValue);

                for (let i = 0; i < files.files.length; i++) {
                    formData.append("files", files.files[i]);
                }

                fetch(url, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        authorization: token
                    }
                })
                .then(response => response.json())
                .then((data) => {
                    hiddenLoader();
                    console.log(data.filename)
                    if (!data.filename) {
                        showAlertPopup(data.result);
                        hiddenDownloadTable();
                    } else {
                        const pandas = document.getElementById("pandas-table");
                        pandas.innerHTML = data.result;
                        pandas.className = data.filename;
                        showDownloadTable();
                    }
                })
                .catch((err) => {
                    hiddenLoader();
                    showAlertPopup("Документ не найден");
                    hiddenDownloadTable();
                });
            }

            function savePython() {
                const currentUrl = window.location.href;
                const url = currentUrl + 'save_python';

                const token = loadToken();
                if (!token) { return; }
                showLoader();

                const files = document.getElementById("python-files");
                const formData = new FormData();
                formData.append('fileName', files.files[0].name);
                formData.append("files", files.files[0]);

                fetch(url, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        authorization: token
                    }
                })
                .then(response => response.json())
                .then((data) => {
                    hiddenLoader();
                    getTemplatesList();
                })
                .catch((err) => {
                    hiddenLoader();
                    showAlertPopup("Скрипт не сохранен");
                });


                $.ajax({
                    url: url,
                    method: 'POST',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    data: formData,
                    contentType: false,
                    processData: false,
                    async: true,
                    success: function(response) {
                        getTemplatesList();
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        showAlertPopup("Скрипт не сохранен");
                    }
                });
            }

            function loadInstructionForCurrentTemplate() {
                const currentUrl = window.location.href;
                const url = currentUrl + 'instruction';

                const token = loadToken();
                if (!token) { return; }

                const selectValue = document.getElementById("templates-list").value;

                $.ajax({
                    url: url,
                    method: 'POST',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    data: { template: selectValue },
                    success: function(response) {
                        if (response.result) {
                            showInfoPopup(response.result);
                        } else {
                            showInfoPopup("Инструкция не найдена. Добавьте инструкцию, через настройки");
                        }
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        showInfoPopup("Инструкция не найдена. Добавьте инструкцию, через настройки");
                    }
                });

            }

            function saveSetting(obj) {
                const currentUrl = window.location.href;
                const url = currentUrl + 'new_setting';

                const token = loadToken();
                if (!token) { return; }

                $.ajax({
                    url: url,
                    method: 'POST',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    data: obj,
                    success: function(response) {
                        showAlertPopup("Настройка сохранена");

                        const name = obj.title + '.json';
                        const select = document.getElementById("settings-list");

                        if (!hasOption(name, select)) {
                            const option = document.createElement("option");
                            const div = document.createElement("div");
                            div.className = "setting";
                            div.appendChild(document.createTextNode(name));
                            option.appendChild(div);
                            select.appendChild(option);
                        }
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        showAlertPopup("Настройка не сохранена");
                    }
                });
            }

            function loadCurrentSetting() {
                const selectValue = document.getElementById("settings-list").value;

                const token = loadToken();
                if (!token) { return; }

                const currentUrl = window.location.href;
                const url = currentUrl + 'setting';

                $.ajax({
                    url: url,
                    method: 'POST',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                    },
                    data: { name: selectValue },
                    success: function(data) {
                        loadTable(data.result);
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        showAlertPopup("Настройки не загружены");
                    }
                });
            }

            function loadToken() {
                return localStorage.getItem('excel_pandas_token');
            }

            function downloadCurrentTemplate() {
                const selectValue = document.getElementById("templates-list").value;

                const token = loadToken();
                if (!token) { return; }

                const currentUrl = window.location.href;
                const url = currentUrl + 'download_template?filename=' + selectValue;

                fetch(url, {
                    headers: {
                        authorization: token
                    }
                })
                .then(response => response.blob())
                .then(blob => {
                    // Create a download link
                    const downloadLink = document.createElement('a');
                    const objectUrl = URL.createObjectURL(blob);
                    downloadLink.href = objectUrl;
                    downloadLink.download = selectValue;

                    downloadLink.click();

                    URL.revokeObjectURL(objectUrl);
                })
                .catch(error => {
                    showAlertPopup("Нет файла");
                });
            }

            function downloadCurrentTable() {
                const pandas = document.getElementById("pandas-table");
                filename = pandas.className;

                if (filename.length === 0) {
                    return;
                }

                const token = loadToken();
                if (!token) { return; }

                const currentUrl = window.location.href;
                const url = currentUrl + 'download?filename=' + filename;

                fetch(url, {
                    headers: {
                        authorization: token
                    }
                })
                .then(response => response.blob())
                .then(blob => {
                    // Create a download link
                    const downloadLink = document.createElement('a');
                    const objectUrl = URL.createObjectURL(blob);
                    downloadLink.href = objectUrl;
                    downloadLink.download = filename;

                    downloadLink.click();

                    URL.revokeObjectURL(objectUrl);
                })
                .catch(error => {
                    showAlertPopup("Нет файла");
                });
            }

            function hasOption(value, select) {
                options = select.options;

                for(var i = 0; i< options.length; i++){
                    if(options[i].value == value){
                        return true;
                    }
                }
                return false;
            }

            function loadVideos() {
                const selectValue = document.getElementById("videos-list");
                const selectedOption = selectValue.options[selectValue.selectedIndex];
                const selectedChild = selectedOption.firstChild;
                closeSettingsPopup();
                const url = selectedChild.getAttribute("url");
                const link = document.createElement("a");
                link.href = url;
                link.target = "_blank";
                link.click();
            }

            loadToken();
            getTemplatesList();
            getSettingsList();
            getVideosList();

            // $(document).ready(function() {
            //     $('#excelColumn').on('paste', function(event) {
            //         var clipboardData = event.originalEvent.clipboardData.getData('text');
            //         var values = clipboardData.split('\n');
            //         $('#contractor-list').empty();
            //         for (var i = 0; i < values.length; i++) {
            //             if (values[i]) {
            //                 $('#contractor-list').append('<li>' + values[i].trim() + '</li>');
            //             }
            //         }
            //         return false;
            //     });
            // });

        </script>
        <style>

            .title {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .download-button-wrapper {
                align-items: center;
                justify-content: center;
                min-height: 60px;
                display: none;
            }

            .wrapper-setting {
                position: fixed;
            } 

            .wrapper-uploader {
                top: 0;
                left: 0;
                position: fixed;
                height: 100%;
                max-width: 0;
                width: 30%;
                background: aliceblue;
                border-right: 1px solid;
                overflow: hidden;
                padding-left: 30px;
                padding-top: 40px;
                z-index: 10;
                margin-top: 0;
            }

            .wrapper-uploader:hover {
                max-width: 100%;
            }

            .wrapper-setting {
                position: fixed;
                top: 0;
                right: 0;
                margin-top: 5px;
                margin-right: 25px;
            }

            .settings-items {
                height: 60vh;
                display: flex;
            }

            .add-settings-item {
                width: fit-content;
                margin: 5px;
            }

            .setting-button {
                position: absolute;
                top: 15px;
                left: 250px;
            }

            .settings-item {
                padding: 15px;
                overflow-y: scroll;
            }

            #settings-list {
                width: fit-content;
                min-height: 30px;
                padding: 5px 10px;
                min-width: 15%;
                margin: 5px;
            }

            #settingsNameInput {
                margin: 5px;
                color: white;
            }

            #settingsLoadNameInput {
                margin: 5px;
            }

            .uploader {
                margin-right: 10px;
            }

            #upload-form {
                min-height: 30px;
                margin: 0;
            }

            .uploader {
                margin-right: 10px;
            }

            .uploader {
                margin-right: 10px;
            }

            #templates-list {
                width: 100%;
                min-height: 30px;
                padding: 5px 10px;
            }

            #pandas-table {
                width: 100%;
                display: flex;
                position: relative;
            }

            #alert-popup-wrapper {
                display: none;
                position: fixed;
                top: 0;
                bottom: 0;
                right: 0;
                left: 0;
                align-items: center;
                justify-content: center;
                z-index: 15;
            }

            #info-popup-wrapper {
                position: fixed;
                top: 0;
                bottom: 0;
                right: 0;
                left: 0;
                align-items: center;
                justify-content: center;
                display: none;
                z-index: 15;
            }

            #settings-popup-wrapper {
                position: fixed;
                top: 0;
                bottom: 0;
                right: 0;
                left: 0;
                align-items: center;
                justify-content: center;
                display: none;
                z-index: 5;
            }

            .settings-popup {
                width: 90%;
                height: 90%;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                margin-bottom: 80px;
            }

            .close-action {
                position: absolute;
                right: 25px;
                top: 25px;
            }

            .alert-popup {
                min-width: 20%;
                max-width: 50%;
            }

            #error-title {
                color: #f65d5e;
                font-weight: 600;
                font-size: 22px;
            }

            .settings-title {
                border-bottom: 1px solid black;
                padding: 5px;
                color: black;
                font-weight: 600;
            }

            .error-close {
                border-top: 1px solid;
                padding: 5px;
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 30px;
            }

            #error-text {
                height: 100%;
                padding: 5px;
            }

            #loader-wrapper {
                width: 100%;
                display: none;
                align-items: center;
                justify-content: center;
                margin-top: 20%;
                position: fixed;
            }

            #pandas-table table {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 3%;
                right: 0;
                max-width: 90%;
            }

            .table-button {
                padding-top: 10px;
            }

            td textarea {
                min-width: 15%;
                width: fit-content;
                color: white;
                border: 1px solid #9e9e9e;
            }

            th textarea {
                min-width: 15%;
                width: fit-content;
                color: white;
                border: 1px solid #9e9e9e;
            }

            th {
                padding: 5px 5px;
            }

            tr {
                border: none;
            }

            td {
                padding: 0 5px;
            }

            thead tr th textarea {
                background-color: white;
                color: #26a69a;
                max-height: 25px;
            }

            caption {
                font-weight: 600;
                font-size: 22px;
                color: white;
                border-bottom: 1px solid;
            }

            body {
                background-color: rgba(255,255,255,0.9);
            }

        </style>
    </body>
</html>